<!DOCTYPE html>
<html>
<head>
	<title>Tests for: js-min</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<style>
		.template, .instance {
			border: black 1px solid;
			padding: 1em;
			margin: 1em;
		}
		.instance {
			border-color: #eee;
		}
	</style>
	<h1>These are tests for my JavaScript Framework</h1>
	<p>You can find out more about it at <a href="https://github.com/evan-brass/js-framework">https://github.com/evan-brass/js-framework</a> or view the code that generates these examples here: <a href="https://github.com/evan-brass/js-framework/blob/master/test.html">https://github.com/evan-brass/js-framework/blob/master/test.html</a></p>
	<template id="pre-computed-templates">
		<template id="a466ba70e">
			<!--{"parts":[{"type":"attribute","order":0},{"type":"attribute","order":1},{"type":"attribute","order":2},{"type":"attribute","order":3}]}--><section class="dial-container">
				<h1><!--{"type":"node","order":4}--></h1>
				<div class="marker">^</div>
				<!--{"type":"node","order":5}-->
				<link rel="stylesheet" href="./src/tests/dial.css">
			</section>
		</template>
		<template id="a288b17e6">
			<h2>Test Swapping</h2>
			<!--{"type":"node","order":0}-->
		</template>
		<template id="a3a55e3d7">
			<!--{"parts":[{"type":"attribute","order":0}]}--><input type="number"><br>
			Binary: 
				<span style="color: red;"><!--{"type":"node","order":1}-->(<!--{"type":"node","order":2}-->)</span>
				<span style="color: green;"><!--{"type":"node","order":3}-->(<!--{"type":"node","order":4}-->)</span>
				<span style="color: blue;"><!--{"type":"node","order":5}-->(<!--{"type":"node","order":6}-->)</span><br>
			Block Address: <!--{"type":"node","order":7}--><br>
			Block's First Byte Address: <!--{"type":"node","order":8}--><br>
			Block ID in Cache: <!--{"type":"node","order":9}-->
		</template>
		<template id="a1bde4965">
			<h2>Test modifying SVG attribute</h2>
			<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
					<!--{"shared":[[""]],"parts":[{"type":"attribute-value","order":0,"attrName":"r","index":0,"sharedIndex":0}]}--><circle cx="50" cy="50" r=""></circle>
			</svg>
			<!--{"shared":[[""]],"parts":[{"type":"attribute-value","order":1,"attrName":"value","index":0,"sharedIndex":0},{"type":"attribute","order":2}]}--><input type="range" value="" min="10" max="70" step="1">
		</template>
		<template id="a63d071f9">
			<!--{"shared":[[""," mixed with ",""," other things"]],"parts":[{"type":"attribute-value","order":0,"attrName":"class","index":0,"sharedIndex":0},{"type":"attribute-value","order":1,"attrName":"class","index":2,"sharedIndex":0}]}--><section class=" mixed with  other things">
				<!--{"parts":[{"type":"attribute","order":2}]}--><header>
					<h1><!--{"type":"node","order":3}--></h1>
				</header>
				<!-- Test user comments: } not; JSON' { -->
			</section>
		</template>
		<template id="a912e41e">
			<form action="" method="">
				<select>
					<!--{"shared":[["before ",""," after"]],"parts":[{"type":"attribute-value","order":0,"attrName":"selected","index":1,"sharedIndex":0}]}--><option selected="before  after">Guts of an option</option>
				</select>
			</form>
		</template>
		<template id="a34543559">
				<!--{"parts":[{"type":"attribute","order":0}]}--><button>-</button>
				<!--{"type":"node","order":1}-->
				<!--{"parts":[{"type":"attribute","order":2}]}--><button>+</button>
		</template>
		<template id="a2e38afe0"><!--{"type":"node","order":0}--> <!--{"type":"node","order":1}--></template>
		<template id="a39c700"><!--{"type":"node","order":0}--></template>
		<template id="a69549e92"><!--{"shared":[["transform: translateX(-50%) rotateZ(","","deg);"]],"parts":[{"type":"attribute-value","order":0,"attrName":"style","index":1,"sharedIndex":0}]}--><span style="transform: translateX(-50%) rotateZ(deg);"><!--{"type":"node","order":1}--></span></template>
		<template id="a3eec6129"><span><!--{"type":"node","order":0}--></span></template>
		<template id="a64503b0c">
			<!--{"shared":[["transform: rotate(-","","deg)"]],"parts":[{"type":"attribute-value","order":0,"attrName":"style","index":1,"sharedIndex":0}]}--><div class="dial" style="transform: rotate(-deg)">
				<!--{"type":"node","order":1}-->
			</div>
			<!--{"shared":[["digits ",""]],"parts":[{"type":"attribute-value","order":2,"attrName":"class","index":1,"sharedIndex":0}]}--><div class="digits "><!--{"type":"node","order":3}--></div>
			<div>
				<!--{"type":"node","order":4}-->
			</div>
		</template>
		<template id="a4d5401ff"><b>Should Swap:</b><!--{"type":"node","order":0}--></template>
		<template id="a478f217c">First: Set the count to 25...<br>
				<!--{"type":"node","order":0}--></template>
		<template id="a3f181a7c"><i>Shouldn't Swap</i></template>
		<template id="a3dead1ff">
			Next: Set the thingy to 5<br>
			<label>
				<!--{"type":"node","order":0}-->
				<!--{"shared":[[""]],"parts":[{"type":"attribute-value","order":1,"attrName":"value","index":0,"sharedIndex":0},{"type":"attribute","order":2}]}--><input type="range" value="" min="0" max="10" step="1">
			</label>
		</template>
	</template>
	<script type="module">
		import LiveData from './src/lib/live-data.mjs';
		import {s, on, mount} from './src/expressions.mjs';
		import html, {html_id} from './src/min.mjs';
		import {ArrayInstance} from './src/instance.mjs';
		import delay from './src/lib/delay.mjs';
		import dial from './src/tests/dial-transpiled.mjs';

		import {registerTemplate} from './src/template.mjs';

		// Register the templates that have been sent by the server and are precomputed:
		for (const template of document.getElementById('pre-computed-templates').content.children) {
			registerTemplate(template.id, template);
		}

		const tests = [
			dial(),
			(function() {
				return html_id('a288b17e6', [
					(async function*() {
						function shouldSwap(txt) {
							return html_id('a4d5401ff', [s(txt)]);
						}
						while(1) {
							yield shouldSwap('1');
							await delay(1000);
							yield shouldSwap('2');
							await delay(1000);
							yield html_id('a3f181a7c', []);
							await delay(1000);
						}
					})()
				]);
			})(),
			(function(){
				const address = new LiveData();
				address.value = 0;
				async function* ag_map(iteration, func) {
					for await(const val of iteration) {
						yield func(val);
					}
				}
				function split(iteration, initial) {
					const ld = new LiveData();
					ld.value = initial;
					(async () => {
						// Run
						for await(const value of iteration) {
							ld.value = value;
						}
					})();
					return ld;
				}
				const binary = split(ag_map(address, a => a.toString(2).padStart(32, '0')), '0'.repeat(32));
				const tag = split(ag_map(binary, b => b.slice(0, 21)));
				const index = split(ag_map(binary, b => b.slice(21, 26)), '0'.repeat(5));
				const offset = split(ag_map(binary, b => b.slice(26)));
				return html_id('a3a55e3d7', [
					on('change', e => address.value = e.target.valueAsNumber),
					tag,
					ag_map(tag, n => Number.parseInt(n, 2)),
					index,
					ag_map(index, n => Number.parseInt(n, 2)),
					offset,
					ag_map(offset, n => Number.parseInt(n, 2)),
					ag_map(address, a => Math.floor(a / 128)),
					ag_map(address, a => {
						const fb = a & ~0b111111
						return `${fb.toString(2).padStart(32, '0')}(${fb})`;
					}),
					ag_map(address, a => Math.floor(a / 128) % 32)
				]);
			})(),
			/* No Longer works... I either need a stylesheet part (could be simple text replacement) or something else.  Due to the stylesheet constructor, anything I would do without the stylesheet constructor would be poor design later on so I'd rather wait.  If I did a syle part then I'd want to make it so that added and removed it's stylesheet from .getRootNode().adoptedStylesheets
			(function(){
				const color = new LiveData();
				color.value = 'black';
				return html`
				<h2 class="testing-css">Test Modifying CSS using NodePart</h2>
				<style>.testing-css{ color: ${color}; }</style>
				${new ArrayInstance([
					'Red', 'Cornsilk', 'Black', 'Navy', 'Teal', 'RebeccaPurple'
				].map(val => html`<button ${on('click', _ => color.value = val.toLowerCase())}>${s(val)}</button>`))}
				`;
			})(),
			*/
			(function(){
				const radius = new LiveData();
				radius.value = 50;
				return html_id('a1bde4965', [
					radius,
					s(radius.value),
					on('change', e => radius.value = e.target.valueAsNumber)
				]);
			})(),
//			/*
			// Simple Test with Comment node
			html_id('a63d071f9', [
				s("a"),
				s("b"),
				s({class: "purple"}),
				s("Text Location")
			]),

			// Test if the marker get's lost when it's value doesn't match the attribute
			html_id('a912e41e', [
				s('')
			]),


			// Sample with event handlers
			(function(){
				const count = new LiveData();
				count.value = 10;
				return html_id('a34543559', [
					on('click', () => count.value -= 1),
					count,
					on('click', () => count.value += 1)
				]);
			})(),

			// Troubleshooting a bug
			html_id('a2e38afe0', [s('another'), s('hello')]),

//			*/
			
			// Test for using multiple templates swapped by async generator as a state machine
			html_id('a39c700', [
				(async function*() {
					const count = new LiveData();
					count.value = 10;
					yield html_id('a478f217c', [
							s(html_id('a34543559', [
								on('click', () => count.value -= 1),
								count,
								on('click', () => count.value += 1)
							]))
					]);
					for await(const val of count) {
						if (val == 25) break;
					}
					count.value = 0;
					yield html_id('a3dead1ff', [
						count,
						s(count.value),
						on('change', e => count.value = e.target.valueAsNumber)
					]);
					for await(const val of count) {
						if (val == 5) break;
					}
					yield `Good Job ðŸŽ‰  Thank you for following along`;
				})()
			])
		];
		performance.mark('start-test-rendering');
		for (const test of tests) {
			const instanceContainer = document.createElement('div');
			instanceContainer.classList.add('instance');
			mount(test, instanceContainer);
			document.body.append(instanceContainer);
		}
		performance.measure('render-time');
		const [renderEntry] = performance.getEntriesByName('render-time')
		console.log(renderEntry.duration);
	</script>
</body>
</html>