<!DOCTYPE html>
<html>
<head>
	<title>Custom Element based Tests</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="triple-byte.css" />
</head>
<body>
	<main>
		<section class="winnie">
			<header>
				<h1>Winnie</h1>
			</header>
			<ul>
			</ul>
			<button onclick="javascript:addCard('winnie')">+ Add a Card</button>
		</section>
		<section class="bob">
			<header>
				<h1>Bob</h1>
			</header>
			<ul></ul>
			<button onclick="javascript:addCard('bob')">+ Add a Card</button>
		</section>
		<section class="thomas">
			<header>
				<h1>Thomas</h1>
			</header>
			<ul>
			</ul>
			<button onclick="javascript:addCard('thomas')">+ Add a Card</button>
		</section>
		<section class="george">
			<header>
				<h1>George</h1>
			</header>
			<ul>
			</ul>
			<button onclick="javascript:addCard('george')">+ Add a Card</button>
		</section>
	</main>
	<script type="application/ECMAScript">
		const userOrder = ['winnie', 'bob', 'thomas', 'george'];

		function getUserTasks(user) {
			const items = Array.from(document.querySelectorAll(`.${user} ul li span`));
			const userTasks = items.map(el => el.innerText);
			return userTasks;
		}

		(function loadStoredTasks(){
			userOrder.forEach(user => {
				const json = window.localStorage.getItem(user) || '["Test 1", "Test 2"]';
				const pastData = JSON.parse(json);
				pastData.forEach(task => addCard(user, task));
			});
		})();
		function addCard(user, contents) {
			const el = document.body.querySelector(`.${user} ul`);
			const newItem = document.createElement('li');
			const content_holder = document.createElement('span');
			if (user !== 'winnie') {
				const leftButton = document.createElement('button');
				leftButton.onclick = () => {
					newItem.remove();
					window.localStorage.setItem(user, JSON.stringify(getUserTasks(user)));
					newItem.querySelectorAll('button').forEach(element => {
						element.remove();
					});
					addCard(userOrder[userOrder.indexOf(user) - 1], newItem.innerText);
				}
				leftButton.innerText = "<";
				newItem.appendChild(leftButton);
			}
			if (!contents) {
				contents = window.prompt("New Task for " + user);
				if (contents == null) return;
			}
			newItem.appendChild(content_holder);
			content_holder.innerText = contents;
			if (user !== 'george') {
				const leftButton = document.createElement('button');
				leftButton.onclick = () => {
					newItem.remove();
					window.localStorage.setItem(user, JSON.stringify(getUserTasks(user)));
					newItem.querySelectorAll('button').forEach(element => {
						element.remove();
					});
					addCard(userOrder[userOrder.indexOf(user) + 1], newItem.innerText);
				}
				leftButton.innerText = ">";
				newItem.appendChild(leftButton);
			}
			el.appendChild(newItem);
			window.localStorage.setItem(user, JSON.stringify(getUserTasks(user)));
		}
	</script>
	<script type="module">
		import props from './src/props.mjs';
		import behavior from './src/behavior.mjs';
		import html from './src/html.mjs';
		import on from './src/users/on.mjs';

		class TaskBoard extends behavior(
			async function*() {
				yield html`First: Set the count to 25...<br />
					<button ${on('click', () => this.count -= 1)}>-</button>
					${this._data.count}
					<button ${on('click', () => this.count += 1)}>+</button>
				`;
				for await(const val of this._data.count) {
					if (val == 25) break;
				}
				this._data.count.value = 3;
				yield html`
					Next: Set the thingy to 5<br />
					<label>
						${this._data.count}
						<input type="range" 
							value="${this._data.count.value}" 
							min="0" max="10" step="1" 
							${on('input', e => this.count = e.target.valueAsNumber)}
						/>
					</label>
				`;
				for await(const val of this._data.count) {
					if (val == 5) break;
				}
				yield `Good Job ðŸŽ‰  Thank you for following along`;
			},
		props({
			contents: {
				type: String,
				default: ""
			}
		})) {}

		customElements.define('task-board', TaskBoard, {

		});
	</script>
	<template id="pregenerated-templates">
	</template>
</body>
</html>